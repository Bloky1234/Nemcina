<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Uƒçenie slov√≠ƒçok</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .btn-option { margin: 6px 0; font-size: 1.1rem; }
    .correct { background-color: #b6fbb6 !important; }
    .wrong { background-color: #ffb6b6 !important; }
    .main-container { max-width: 500px; margin: 0 auto; padding: 20px; }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="main-container">
    <div id="loader" class="card shadow p-4 mb-4">
      <h1 class="mb-4 text-center">Uƒçenie slov√≠ƒçok</h1>

      <div class="mb-3">
        <label for="lektionSelect" class="form-label">Vyber lekciu:</label>
        <select class="form-select" id="lektionSelect"></select>
      </div>

      <div class="mb-3">
        <label class="form-check">
          <input type="radio" name="smer" value="en-sk" class="form-check-input" checked>
          <span class="form-check-label">Nemƒçina ‚Üí Slovenƒçina</span>
        </label>
        <label class="form-check">
          <input type="radio" name="smer" value="sk-en" class="form-check-input">
          <span class="form-check-label">Slovenƒçina ‚Üí Nemƒçina</span>
        </label>
        <label class="form-check">
          <input type="radio" name="smer" value="mix" class="form-check-input">
          <span class="form-check-label">Mix (oboma smermi)</span>
        </label>
      </div>

      <button class="btn btn-primary w-100" onclick="startQuiz()">Spusti test</button>
    </div>

    <div id="quiz" class="card shadow p-4 d-none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 id="question" class="fs-4 m-0"></h2>
        <button class="btn btn-sm btn-secondary" onclick="goHome()">Domov</button>
      </div>
      <div id="options" class="d-flex flex-column"></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
let slovicka = [];
let nezodpovedane = [];
let smer = "en-sk";
let spravne = 0;
let nespravne = 0;

// zmena smeru
document.querySelectorAll('input[name="smer"]').forEach(radio => {
  radio.addEventListener("change", e => smer = e.target.value);
});

// dynamicky vyplnit dropdown lekcii, podla existencie suborov
async function initLekcie() {
  const select = document.getElementById("lektionSelect");
  select.innerHTML = "";

  for (let i = 1; i <= 20; i++) {
    // najprv sk√∫s hlavn√Ω s√∫bor (napr. lekcia1.txt)
    const baseFile = `lekcia${i}.txt`;
    let foundAny = false;

    try {
      const resp = await fetch(baseFile, { method: 'HEAD' });
      if (resp.ok) {
        const opt = document.createElement("option");
        opt.value = baseFile;
        opt.textContent = `Lekcia ${i}`;
        select.appendChild(opt);
        foundAny = true;
      }
    } catch (e) { /* s√∫bor neexistuje */ }

    // teraz sk√∫s podlekcie typu lekcia1.1.txt, lekcia1.2.txt, ...
    for (let j = 1; j <= 10; j++) {
      const subFile = `lekcia${i}.${j}.txt`;
      try {
        const resp = await fetch(subFile, { method: 'HEAD' });
        if (resp.ok) {
          const opt = document.createElement("option");
          opt.value = subFile;
          opt.textContent = `Lekcia ${i}.${j}`;
          select.appendChild(opt);
          foundAny = true;
        }
      } catch (e) { /* s√∫bor neexistuje */ }
    }
  }

  if (select.options.length === 0) {
    const opt = document.createElement("option");
    opt.textContent = "≈Ωiadna lekcia nen√°jden√°";
    opt.disabled = true;
    select.appendChild(opt);
  }
}


// start testu
async function startQuiz() {
  const lekcia = document.getElementById("lektionSelect").value;
  const response = await fetch(lekcia);
  const text = await response.text();
  slovicka = text.split("\n").map(r => {
    const [en, sk] = r.trim().split("//").map(s => s.trim());
    return { en, sk };
  }).filter(x => x.en && x.sk);

  nezodpovedane = [...slovicka];
  spravne = 0;
  nespravne = 0;

  document.getElementById("loader").classList.add("d-none");
  document.getElementById("quiz").classList.remove("d-none");
  novaOtazka();
  window.scrollTo(0, 0);
}

function novaOtazka() {
  if (nezodpovedane.length === 0) {
    document.getElementById("quiz").innerHTML = `
      <h2 class="mb-3 text-center">Hotovo! üéâ</h2>
      <p class="fs-5 text-center">Spr√°vne odpovede: <b>${spravne}</b></p>
      <p class="fs-5 text-center">Nespr√°vne odpovede: <b>${nespravne}</b></p>
      <button class="btn btn-primary w-100 mt-3" onclick="goHome()">Domov</button>
    `;
    window.scrollTo(0, 0);
    return;
  }

  const otazka = nezodpovedane[Math.floor(Math.random() * nezodpovedane.length)];
  let realSmer = smer === "mix" ? (Math.random() < 0.5 ? "en-sk" : "sk-en") : smer;

  let questionText, correctAnswer, allAnswers;
  if (realSmer === "en-sk") {
    questionText = `Prelo≈æ: ${otazka.en}`;
    correctAnswer = otazka.sk;
    allAnswers = slovicka.map(s => s.sk);
  } else {
    questionText = `Prelo≈æ: ${otazka.sk}`;
    correctAnswer = otazka.en;
    allAnswers = slovicka.map(s => s.en);
  }

  document.getElementById("question").innerText = questionText;

  let moznosti = [correctAnswer];
  while (moznosti.length < 4 && allAnswers.length >= 4) {
    const nahodne = allAnswers[Math.floor(Math.random() * allAnswers.length)];
    if (!moznosti.includes(nahodne)) moznosti.push(nahodne);
  }
  moznosti = moznosti.sort(() => Math.random() - 0.5);

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  moznosti.forEach(moz => {
    const btn = document.createElement("button");
    btn.textContent = moz;
    btn.className = "btn btn-outline-dark btn-option";
    btn.onclick = () => {
      if (moz === correctAnswer) {
        btn.classList.add("correct");
        spravne++;
        nezodpovedane = nezodpovedane.filter(s => s !== otazka);
        setTimeout(() => { novaOtazka(); window.scrollTo(0, 0); }, 700);
      } else {
        btn.classList.add("wrong");
        nespravne++;
      }
    };
    optionsDiv.appendChild(btn);
  });
  window.scrollTo(0, 0);
}

function goHome() {
  document.getElementById("quiz").classList.add("d-none");
  document.getElementById("loader").classList.remove("d-none");
  slovicka = [];
  nezodpovedane = [];
  spravne = 0;
  nespravne = 0;
  document.getElementById("options").innerHTML = "";
  document.getElementById("question").innerText = "";
  window.scrollTo(0, 0);
}

// inicializacia dropdownu
initLekcie();
</script>
</body>
</html>
